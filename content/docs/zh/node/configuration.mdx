---
title: 配置
description: 配置 PasarGuard 节点设置和环境变量
icon: Cog
---

## 配置概述

PasarGuard 节点可以使用环境变量进行配置。所有设置都可以在 `.env` 文件中设置或直接作为环境变量设置。

## 环境变量

### 基本设置

| 变量 | 类型 | 默认值 | 描述 |
|----------|------|---------|-------------|
| `SESSION_ID` | string | `random_uuid` | API 访问的身份验证令牌 |
| `HOST` | string | `0.0.0.0` | 服务器主机地址 |
| `PORT` | int | `443` | 服务器端口号 |
| `DEBUG` | bool | `false` | 启用调试模式以进行详细日志记录 |

### SSL/TLS 配置

| 变量 | 类型 | 默认值 | 描述 |
|----------|------|---------|-------------|
| `TLS_ENABLE` | bool | `true` | 启用 TLS/SSL |
| `TLS_CERT_FILE` | string | `./cert/server.crt` | SSL 证书路径 |
| `TLS_KEY_FILE` | string | `./cert/server.key` | SSL 私钥路径 |

### 后端配置

| 变量 | 类型 | 默认值 | 描述 |
|----------|------|---------|-------------|
| `BACKEND_TYPE` | string | `xray` | 后端核心类型（xray、sing-box、v2ray） |
| `BACKEND_KEEP_ALIVE` | int | `60` | 最后一次连接后保持后端活动 X 秒 |
| `BACKEND_LOG_LEVEL` | string | `warning` | 后端日志级别（debug、info、warning、error） |

### API 配置

| 变量 | 类型 | 默认值 | 描述 |
|----------|------|---------|-------------|
| `API_ENABLE_REST` | bool | `true` | 启用 REST API |
| `API_ENABLE_GRPC` | bool | `true` | 启用 gRPC API |
| `GRPC_PORT` | int | `50051` | gRPC 服务器端口 |

### 性能设置

| 变量 | 类型 | 默认值 | 描述 |
|----------|------|---------|-------------|
| `MAX_CONNECTIONS` | int | `10000` | 最大并发连接数 |
| `STATS_INTERVAL` | int | `60` | 统计更新间隔（秒） |
| `LOG_BUFFER_SIZE` | int | `1000` | 日志缓冲区大小 |

---

## 配置示例

### 基本 `.env` 文件

```bash
# 基本设置
SESSION_ID=your-secure-session-id-here
HOST=0.0.0.0
PORT=443
DEBUG=false

# SSL 配置
TLS_ENABLE=true
TLS_CERT_FILE=./cert/server.crt
TLS_KEY_FILE=./cert/server.key

# 后端
BACKEND_TYPE=xray
BACKEND_KEEP_ALIVE=60
BACKEND_LOG_LEVEL=warning

# API
API_ENABLE_REST=true
API_ENABLE_GRPC=true
GRPC_PORT=50051
```

### Docker `.env` 文件

```bash
SESSION_ID=your-secure-session-id-here
PORT=443
TLS_ENABLE=true
BACKEND_TYPE=xray
DEBUG=false
```

### 生产 `.env` 文件

```bash
# 生产设置
SESSION_ID=change-this-to-a-secure-random-string
HOST=0.0.0.0
PORT=443
DEBUG=false

# SSL - 使用有效证书
TLS_ENABLE=true
TLS_CERT_FILE=/etc/ssl/certs/your-domain.crt
TLS_KEY_FILE=/etc/ssl/private/your-domain.key

# 后端优化
BACKEND_TYPE=xray
BACKEND_KEEP_ALIVE=120
BACKEND_LOG_LEVEL=warning

# 性能
MAX_CONNECTIONS=50000
STATS_INTERVAL=30
LOG_BUFFER_SIZE=2000

# API
API_ENABLE_REST=true
API_ENABLE_GRPC=true
GRPC_PORT=50051
```

---

## SSL 证书配置

### 生成自签名证书

用于测试或内部使用：

```bash
make generate_server_cert CN=example.com SAN="DNS:example.com,IP:YOUR_IP"
```

### 使用 Let's Encrypt 证书

用于带域名的生产环境：

1. 安装 Certbot：
```bash
sudo apt-get install certbot
```

2. 获取证书：
```bash
sudo certbot certonly --standalone -d your-domain.com
```

3. 更新 `.env`：
```bash
TLS_CERT_FILE=/etc/letsencrypt/live/your-domain.com/fullchain.pem
TLS_KEY_FILE=/etc/letsencrypt/live/your-domain.com/privkey.pem
```

### 使用自定义证书

如果您有自己的证书：

```bash
TLS_CERT_FILE=/path/to/your/certificate.crt
TLS_KEY_FILE=/path/to/your/private.key
```

---

## 后端特定配置

### Xray 核心

使用 Xray 作为后端时：

```bash
BACKEND_TYPE=xray
BACKEND_LOG_LEVEL=warning
```

Xray 配置由节点根据您通过 API 定义的用户和入站自动处理。

---

## 安全最佳实践

### 生成安全的 SESSION_ID

```bash
# Linux/macOS
openssl rand -hex 32

# 或使用 UUID
uuidgen
```

### 文件权限

确保敏感文件具有正确的权限：

```bash
# 证书文件
chmod 600 ./cert/server.key
chmod 644 ./cert/server.crt

# 环境文件
chmod 600 .env
```

### 防火墙配置

仅公开必要的端口：

```bash
# 仅允许节点端口
sudo ufw allow YOUR_PORT/tcp

# 阻止不必要的端口
sudo ufw enable
```

---

## 故障排除

### 常见问题

**端口已被使用：**
```bash
# 在 .env 中更改端口
PORT=8443
```

**证书错误：**
```bash
# 验证证书文件是否存在
ls -la ./cert/

# 检查证书有效性
openssl x509 -in ./cert/server.crt -text -noout
```

**权限被拒绝：**
```bash
# 使用 sudo 运行或将端口更改为 > 1024
PORT=8443
```

